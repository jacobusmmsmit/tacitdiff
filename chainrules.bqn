# Original code by saltysylvi
# https://saltysylvi.github.io/blog/bqn-macros.html

âŸ¨T, _dâŸ©â‡

AST â† â€¢Import "ast.bqn"

T â† {
  âŸ¨4, f, râŸ©: { # constants
    r=âŠ‘âŸ¨Ë™âŸ© ? 0;
    r=âŠ‘âŸ¨ËœâŸ© ? 2âŠ¸Ã— f
  };  
  âŸ¨5,f,r,gâŸ©: { # partially applied dyads
    râ€¿gâ‰¡âŠ¸â€¿+ ? 1;
    râ€¿fâ‰¡âŸœâ€¿+ ? 1;
    râ€¿gâ‰¡âŠ¸â€¿- ? Â¯1;
    râ€¿fâ‰¡âŸœâ€¿- ? 1;
    râ€¿gâ‰¡âŠ¸â€¿Ã— ? f;
    râ€¿fâ‰¡âŸœâ€¿Ã— ? g;
    râ€¿gâ‰¡âŠ¸â€¿Ã· ? -fÃ·â‹†âŸœ2;
    râ€¿fâ‰¡âŸœâ€¿Ã· ? 1Ã·g;
    râ€¿gâ‰¡âŠ¸â€¿â‹† ? (â‹†â¼f)âŠ¸Ã— fâŠ¸â‹†;
    râ€¿fâ‰¡âŸœâ€¿â‹† ?
      g=2 ? gâŠ¸Ã— ;
      g=1 ? 1 ;
      gÃ—â‹†âŸœ(g-1)
  };
  âŸ¨2,f,gâŸ©: âŸ¨3, T g, Ã—, âŸ¨2, T f, gâŸ©âŸ©; # 2-trains
  âŸ¨3,f,g,hâŸ©: { # 3-trains
    g=âŠ‘âŸ¨+âŸ© ? âŸ¨3, T f, +, T hâŸ©;
    g=âŠ‘âŸ¨-âŸ© ? âŸ¨3, T f, -, T hâŸ©;
    g=âŠ‘âŸ¨Ã—âŸ© ? âŸ¨3, âŸ¨3, h, Ã—, T fâŸ©, +, âŸ¨3, f, Ã—, T hâŸ©âŸ©;
    g=âŠ‘âŸ¨Ã·âŸ© ? âŸ¨3, âŸ¨3, âŸ¨3, h, Ã—, T fâŸ©, -, âŸ¨3, f, Ã—, T hâŸ©âŸ©, Ã·, âŸ¨2, â‹†âŸœ2, hâŸ©âŸ©
  };
  ğ•©: { # monads
    ğ•©=âŠ‘âŸ¨âŠ¢âŸ© ? 1;
    ğ•©=âŠ‘âŸ¨-âŸ© ? Â¯1;
    ğ•©=âŠ‘âŸ¨Ã·âŸ© ? -1Ã·â‹†âŸœ2;
    ğ•©=âŠ‘âŸ¨â‹†âŸ© ? â‹†;
    # ğ•©=âŠ‘âŸ¨âˆ˜âŸ© ? Ã—;
    0 # everything else presumed 0
  }ğ•©
}

_d â† {TâŒ¾AST ğ•—}